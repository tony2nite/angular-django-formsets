/*!
 * AngularJS Django formsets directives v0.0.1 * http://hilios.github.io/angular-django-formset/
 * Copyright (c) 2015 Edson Hilios
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 */

angular.module("ngDjangoFormset",[]),angular.module("ngDjangoFormset").controller("ngDjangoFormsetCtrl",["$attrs","$templateCache","$compile",function(a,b,c){var d=this;d.__fid__=-1,d.__children__=[],d.__template__=b.get(a.formset)||"",d.__formsetprefix__=a.formsetPrefix||"form",d.__candelete__=a.hasOwnProperty("formsetCanDelete")||!1,d.__canorder__=a.formsetCanOrder||!1,d.__formset__=null,d.__container__=null,d.__totalforms__=null,d.__minforms__=0,d.__maxforms__=1e3,d.setup=function(a){d.__formset__=a,d.__template__&&(d.__template__=d.__template__.replace(/^(\s|\n|\t){1,}/gi,""));var b=new RegExp(d.__formsetprefix__+"\\-([0-9]{1,})","i"),c=new RegExp(d.__formsetprefix__+"\\-([A-Z_]+)");if(angular.forEach(d.__children__,function(a){var c,e=a.find("input").prop("name");e=e.match(b),e&&(c=parseInt(e[1]),c>d.__fid__&&(d.__fid__=c))}),angular.forEach(a.find("input"),function(a){var b=angular.element(a),e=b.prop("name").match(c);if(e)switch(e[1]){case"TOTAL_FORMS":d.__totalforms__=b;break;case"INITIAL_FORMS":d.__minforms__=parseInt(b.val())||d.__minforms__;break;case"MAX_NUM_FORMS":d.__maxforms__=parseInt(b.val())||d.__maxforms__}}),!d.__template__)throw new SyntaxError("Template not found");if(!d.__totalforms__)throw new SyntaxError("Could't find formset TOTAL_FORMS input, check if you printed {{formset.management_form}}");if(!d.__container__)throw new SyntaxError("Formset container cound't be found, please add formset-container to a child element")},d.setupContainer=function(a){d.__container__=a},d.update=function(){d.__totalforms__&&d.__totalforms__.val(d.__children__.length)},d.indexOfChild=function(a){for(var b=-1,c=0;c<d.__children__.length;c++){var e=d.__children__[c];if(e[0]==a[0]){b=c;break}}return b},d.addFormset=function(){if(d.__children__.length<d.__maxforms__){d.__fid__+=1;var a=angular.element(d.__template__.replace(/__prefix__/gi,d.__fid__));return d.__container__.append(a),c(a)(d.__formset__.scope()||{}),a}},d.removeFormset=function(a){for(var b=a,c=function(a){return void 0!==a.attr("formset-child")||void 0!==a.attr("data-formset-child")||void 0!==a.attr("x-formset-child")};!c(b)&&"BODY"!==b.prop("tagName");)b=b.parent();if("BODY"!==b.prop("tagName"))if(d.__children__.length>d.__minforms__)try{b.scope().$destroy()}catch(e){}finally{b.remove()}else d.__candelete__===!0&&d.__children__.length>0&&d.markDeleted(b);else b=null;return b},d.registerChild=function(a){d.__children__.push(a),d.update();var b=d.getDeleteCheckboxForChild(a);b&&b.prop("checked")&&d.__candelete__===!0&&d.markDeleted(a)},d.destroyChild=function(a){var b=d.__children__.indexOf(a);d.__children__.splice(b,1),d.update()},d.getDeleteCheckboxForChild=function(a){var b,c=d.indexOfChild(a);if(c>=0&&a.find){var e="#id_"+d.__formsetprefix__+"-"+c+"-DELETE";b=a.find(e),0==b.length&&(b=!1)}return b},d.markDeleted=function(a){var b=d.getDeleteCheckboxForChild(a);b?b.prop("checked",!0):console.log("Couldn't find checkbox:"+name),a.addClass("deleted")}}]),angular.module("ngDjangoFormset").directive("formset",function(){return{require:"formset",restrict:"A",scope:{},controller:"ngDjangoFormsetCtrl",link:function(a,b,c,d){d.setup(b)}}}).directive("formsetContainer",function(){return{require:"^formset",restrict:"A",link:function(a,b,c,d){d.setupContainer(b)}}}).directive("formsetChild",function(){return{require:"^formset",restrict:"A",scope:!0,link:function(a,b,c,d){d.registerChild(b),b.on("$destroy",function(){d.destroyChild(b)})}}}).directive("formsetAdd",function(){return{require:"^formset",restrict:"A",link:function(a,b,c,d){b.on("click",function(a){a.preventDefault(),d.addFormset()}),b.on("$destroy",function(){b.off("click")})}}}).directive("formsetRemove",function(){return{require:"^formset",restrict:"A",link:function(a,b,c,d){b.on("click",function(a){a.preventDefault(),d.removeFormset(b)})}}});
//# sourceMappingURL=dist/angular-django-formset.map